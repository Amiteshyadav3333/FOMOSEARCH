<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ query }} - FOMO Search</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: arial, sans-serif; background: #fff; }
        
        /* Header with search box */
        .header { border-bottom: 1px solid #ebebeb; padding: 20px 0; background: #fff; }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; }
        .logo { font-size: 24px; color: #4285f4; margin-right: 30px; text-decoration: none; font-weight: normal; }
        .search-form { flex: 1; max-width: 600px; }
        .search-box { 
            display: flex; align-items: center; border: 1px solid #dfe1e5; 
            border-radius: 24px; padding: 8px 16px;
        }
        .search-box input { 
            border: none; outline: none; flex: 1; font-size: 16px; 
            padding: 8px; background: transparent;
        }
        .search-icons { display: flex; align-items: center; gap: 8px; }
        .icon-btn { 
            background: none; border: none; cursor: pointer; padding: 6px;
            border-radius: 50%; font-size: 16px;
        }
        .icon-btn:hover { background: #f1f3f4; }
        .filters { margin-left: 20px; }
        .filters select { padding: 6px; margin: 0 5px; border: 1px solid #ddd; border-radius: 3px; font-size: 13px; }
        
        /* Main content */
        .main { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .results-info { margin-bottom: 20px; color: #70757a; font-size: 14px; }
        
        /* Individual result styling */
        .result-item { margin-bottom: 30px; max-width: 600px; }
        .result-title { font-size: 20px; line-height: 1.3; margin-bottom: 3px; }
        .result-title a { color: #1a0dab; text-decoration: none; }
        .result-title a:hover { text-decoration: underline; }
        .result-title a:visited { color: #681da8; }
        .result-url { color: #006621; font-size: 14px; margin-bottom: 5px; }
        .result-snippet { color: #4d5156; line-height: 1.5; font-size: 14px; }
        .result-snippet mark { background: #ffeb3b; font-weight: normal; }
        .result-meta { 
            font-size: 12px; color: #70757a; margin-top: 5px;
            display: flex; align-items: center; gap: 10px;
        }
        .rank-badge { 
            background: #4285f4; color: white; padding: 2px 6px; 
            border-radius: 10px; font-size: 10px;
        }
        .original-site { background: #34a853; }
        
        /* Pagination */
        .pagination { text-align: center; margin: 40px 0; }
        .page-btn, .page-num { 
            display: inline-block; padding: 8px 16px; margin: 0 4px; 
            text-decoration: none; color: #4285f4; font-size: 14px;
        }
        .page-btn:hover, .page-num:hover { background: #f1f3f4; border-radius: 4px; }
        .page-num.active { background: #4285f4; color: white; border-radius: 4px; }
        .page-dots { color: #70757a; padding: 8px 4px; }
        
        /* No results */
        .no-results { text-align: center; padding: 40px; }
        .search-tips { 
            background: #f8f9fa; padding: 20px; border-radius: 8px; 
            margin-top: 20px; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto;
        }
        .search-tips h4 { margin-bottom: 10px; color: #3c4043; }
        .search-tips ul { list-style-type: none; }
        .search-tips li { margin: 8px 0; color: #5f6368; }
        .search-tips li:before { content: '‚Ä¢ '; color: #4285f4; margin-right: 8px; }
        
        /* Error styling */
        .error { background: #fce8e6; color: #d93025; padding: 20px; border-radius: 8px; margin: 20px 0; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 15px; }
            .logo { margin-right: 0; }
            .search-form { width: 100%; }
            .filters { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <a href="/" class="logo">üîç FOMO</a>
            <form class="search-form" action="/search" method="GET">
                <div class="search-box">
                    <input type="text" name="q" value="{{ query }}" autocomplete="off">
                    <div class="search-icons">
                        <button type="button" class="icon-btn" onclick="startVoiceSearch()" title="Voice Search">üé§</button>
                        <button type="button" class="icon-btn" onclick="startCameraSearch()" title="Camera Search">üì∑</button>
                        <button type="submit" class="icon-btn" title="Search">üîç</button>
                    </div>
                </div>
                <input type="hidden" name="time" value="{{ request.args.get('time', '') }}">
                <input type="hidden" name="sort" value="{{ request.args.get('sort', 'relevance') }}">
            </form>
            <div class="filters">
                <select onchange="updateFilter('time', this.value)">
                    <option value="" {% if not request.args.get('time') %}selected{% endif %}>Any time</option>
                    <option value="day" {% if request.args.get('time') == 'day' %}selected{% endif %}>Past day</option>
                    <option value="week" {% if request.args.get('time') == 'week' %}selected{% endif %}>Past week</option>
                    <option value="month" {% if request.args.get('time') == 'month' %}selected{% endif %}>Past month</option>
                    <option value="year" {% if request.args.get('time') == 'year' %}selected{% endif %}>Past year</option>
                </select>
                <select onchange="updateFilter('sort', this.value)">
                    <option value="relevance" {% if request.args.get('sort', 'relevance') == 'relevance' %}selected{% endif %}>Relevance</option>
                    <option value="date" {% if request.args.get('sort') == 'date' %}selected{% endif %}>Date</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="main">
        <div class="results-info">
            About {{ total_results|default(0) }} results ({{ "%.2f"|format(search_time|default(0)) }} seconds)
        </div>
        
        {% if error %}
            <div class="error">
                <strong>Search Error:</strong> {{ error }}
            </div>
        {% elif results %}
            {% for result in results %}
            <div class="result-item">
                <div class="result-title">
                    <a href="{{ result.url }}" target="_blank">{{ result.title or 'Untitled' }}</a>
                </div>
                <div class="result-url">{{ result.url }}</div>
                <div class="result-snippet">{{ result.snippet|safe if result.snippet else 'No description available.' }}</div>
                <div class="result-meta">
                    {% if result.custom_rank and result.custom_rank > 80 %}
                        <span class="rank-badge original-site">Original Site</span>
                    {% elif result.custom_rank and result.custom_rank > 50 %}
                        <span class="rank-badge">High Quality</span>
                    {% endif %}
                    <span>{{ result.domain }}</span>
                    {% if result.crawled_date %}
                        <span>‚Ä¢ {{ result.crawled_date }}</span>
                    {% endif %}
                    {% if result.content_length %}
                        <span>‚Ä¢ {{ result.content_length }} chars</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            
            <!-- Pagination -->
            {% if total_pages and total_pages > 1 %}
            <div class="pagination">
                {% if has_prev %}
                    <a href="/search?q={{ query }}&page={{ current_page - 1 }}&time={{ request.args.get('time', '') }}&sort={{ request.args.get('sort', 'relevance') }}" class="page-btn">‚Üê Previous</a>
                {% endif %}
                
                {% set start_page = [1, current_page - 5]|max %}
                {% set end_page = [total_pages, start_page + 9]|min %}
                
                {% if start_page > 1 %}
                    <a href="/search?q={{ query }}&page=1&time={{ request.args.get('time', '') }}&sort={{ request.args.get('sort', 'relevance') }}" class="page-num">1</a>
                    {% if start_page > 2 %}
                        <span class="page-dots">...</span>
                    {% endif %}
                {% endif %}
                
                {% for i in range(start_page, end_page + 1) %}
                    {% if i == current_page %}
                        <span class="page-num active">{{ i }}</span>
                    {% else %}
                        <a href="/search?q={{ query }}&page={{ i }}&time={{ request.args.get('time', '') }}&sort={{ request.args.get('sort', 'relevance') }}" class="page-num">{{ i }}</a>
                    {% endif %}
                {% endfor %}
                
                {% if end_page < total_pages %}
                    {% if end_page < total_pages - 1 %}
                        <span class="page-dots">...</span>
                    {% endif %}
                    <a href="/search?q={{ query }}&page={{ total_pages }}&time={{ request.args.get('time', '') }}&sort={{ request.args.get('sort', 'relevance') }}" class="page-num">{{ total_pages }}</a>
                {% endif %}
                
                {% if has_next %}
                    <a href="/search?q={{ query }}&page={{ current_page + 1 }}&time={{ request.args.get('time', '') }}&sort={{ request.args.get('sort', 'relevance') }}" class="page-btn">Next ‚Üí</a>
                {% endif %}
            </div>
            {% endif %}
            
        {% else %}
            <div class="no-results">
                <h3>Your search - <strong>{{ query }}</strong> - did not match any documents.</h3>
                
                <div class="search-tips">
                    <h4>Search Tips:</h4>
                    <ul>
                        <li>Make sure all words are spelled correctly</li>
                        <li>Try different keywords</li>
                        <li>Try more general keywords</li>
                        <li>Try using quotes for exact phrases: "machine learning"</li>
                        <li>Try excluding terms: python -java</li>
                        <li>Try site-specific search: site:stackoverflow.com</li>
                    </ul>
                </div>
                
                <p style="margin-top: 20px;">
                    <a href="/">‚Üê Start a new search</a>
                </p>
            </div>
        {% endif %}
    </div>
    
    <script>
        function updateFilter(param, value) {
            const url = new URL(window.location);
            url.searchParams.set(param, value);
            url.searchParams.delete('page'); // Reset to page 1
            window.location.href = url.toString();
        }
        
        // Voice and Camera search functions (same as index.html)
        function startVoiceSearch() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.querySelector('input[name="q"]').value = transcript;
                    document.querySelector('form').submit();
                };
                
                recognition.start();
            } else {
                alert('Voice search not supported in this browser');
            }
        }
        
        function startCameraSearch() {
            alert('Camera search feature - Point camera at text to search');
            // Camera functionality would be implemented here
        }
    </script>
</body>
</html>
